âŸ¨digits, Group, MDSlash, NumâŸ© â† â€¢Import "../../utils/utils.bqn"
schema â† >â€¢FLines "./test2.txt"

dm â† (âŠ‘âˆŠâŸœdigits)Â¨schema
sm â† (âŠ‘âˆŠâŸœ('.'âˆ¾digits))Â¨schema
S â† 1â€¿0â€¿Â¯1âŠ¸(âŒ½âŒœ)Â·1â€¿0â€¿Â¯1âŠ¸(âŒ½Ë˜Â¨)<
pm â† âˆ§Â´âˆ§Ë˜ËS sm
F â† {ğ•©=1âˆ§ğ•¨â‰ 0?ğ•¨;ğ•©}
mask â† 2= F`âˆ˜(F`âŒ¾âŒ½)Ë˜ dm+dmâˆ§Â¬pm

# Part 1
â€¢Show +Â´ NumÂ¨ mask Groupâ—‹â¥Š schema

# Part 2
g1 â† '*'=schema
igm â† +Â´Â·+Ë˜ËS {(â‰¢ğ•©)â¥Š{ğ•©Ã—+`ğ•©}â¥Šğ•©}g1
gm â† +Â´Â·+Ë˜ËS g1
ppm â† Â¬âˆ§Â´âˆ§Ë˜ËS Â¬ 1<g1âˆ§ +Â´+Ë˜ËS dm âˆ§ gm
#+Ë˜Ë1â€¿0â€¿Â¯1âŠ¸(âŒ½Ë˜Â¨)<mmask
mmask â† 2= F`âˆ˜(F`âŒ¾âŒ½)Ë˜ dm+dmâˆ§ppm
imask â† F`âˆ˜(F`âŒ¾âŒ½)Ë˜ igm {ğ•©=0 ? 0; ğ•¨+ğ•©}Â¨ mmask
cogMasks â† {imask=ğ•©}Â¨1+â†•âŒˆÂ´â¥Šimask
â€¢Show ns â† âŸ¨âŸ©âŠ¸â‰¢Â¨âŠ¸/ {NumÂ¨ ğ•© Groupâ—‹â¥Š schema}Â¨ cogMasks
rs â† 1âŠ¸<âˆ˜â‰ Â¨âŠ¸/ ns
â€¢Show +Â´Ã—Â´Â¨rs

# TODO: Finish optimising part 2
l â† >{ğ•© âˆ¾ (3â¥ŠâŸ¨0â€¿0â€¿1â€¿1â€¿1âŸ©) âˆ¾ğ•©} (3â¥Š<(5â¥Š0))
(3â€¿3â¥ŠMDSlashËœ)âŠ¸âŠ‘ l
xâ† mmask + 2Ã—{(â‰¢ğ•©)â¥Š{ğ•©Ã—+`ğ•©}â¥Šğ•©}g1
MDSlashâŸœ(=âŸœ2) x

relSq â† -âŸœ1Â¨â†•3â€¿3

GetSq â† {ğ•© âŠ‘Ëœ ğ•¨âŠ¸+Â¨relSq}

GetSqâŸœdmÂ¨ MDSlashËœ g1
{+Â´{ğ•©â‰¡1â€¿0â€¿1?2;âŠ‘âˆ¨Â´ğ•©}Ë˜ğ•©}Â¨âŒ¾(GetSqâŸœdmÂ¨MDSlashËœ) g1
âŠ‘Â¨âŒ¾(MDSlashËœ) g1
(MDSlashËœ) g1
